public class Solution
{
    public int BeautifulSplits(int[] nums)
    {
        int n = nums.Length;
        int[,] longestMatch = new int[n, n];
        for (int i = 0; i < n; i++)
        {
            for (int j = i+1; j < n; j++)
            {
                if (nums[i] != nums[j])
                {
                    continue;
                }
                longestMatch[i, j] = 1;
                if (i > 0)
                {
                    longestMatch[i, j] += longestMatch[i-1, j-1];
                }
            }
        }
        int result = 0;
        for (int i = 1; i < n-1; i++)
        {
            for (int j = i+1; j < n; j++)
            {
                int len1 = i;
                int len2 = j-i;
                int len3 = n-j;
                if (
                    (len1 <= len2 && longestMatch[i-1, i-1+len1] == len1) ||
                    (len2 <= len3 && longestMatch[j-1, j-1+len2] >= len2))
                {
                    result++;
                }
            }
        }
        return result;
    }
}
