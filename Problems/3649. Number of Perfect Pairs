public class Solution {
    public long PerfectPairs(int[] nums) {
        Dictionary<int, int> freq = new();
        foreach(int n in nums)
        {
            int absN = Math.Abs(n);
            if(!freq.ContainsKey(absN))
                freq.Add(absN, 0);

            freq[absN]++;
        }

        List<int> keys = freq.Keys.ToList();
        keys.Sort();
        int pre = 0;
        for(int i = 1; i < keys.Count; i++)
        {
            freq[keys[i]] += freq[keys[i-1]];
        }

        long res = 0;
        int left = 0;
        for(int i = 0; i < keys.Count; i++)
        {
            // case a == b;
            int curK = keys[i], curF = freq[curK] - (i > 0 ? freq[keys[i-1]] : 0);
            if(curF > 1)
            {
                long tmp = ((long)curF*(curF-1)/2);
                res += tmp;
            }

            while(left < i && keys[left]*2 < curK)
            {
                left++;
            }

            if(left < i)
            {
                int lowF = freq[keys[i-1]] - (left > 0 ? freq[keys[left-1]] : 0);
                res += (long)curF*lowF;
            }
        }

        return res;
    }
}
