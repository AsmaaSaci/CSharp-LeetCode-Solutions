public class Solution {
    public int MaxSubstrings(string word) {
			int len = word.Length;
			if (len < 4)
				return 0;

			List<int>[] preIds = new List<int>[26];
			int[] maxSplit = new int[len];

			for (int i = 0; i < 26; i++)
			{
				preIds[i] = new List<int>();
			}

			for (int i = 0; i < len; i++)
			{
				int id = word[i] - 'a';

				if (i > 0)
					maxSplit[i] = maxSplit[i - 1];

				if (preIds[id].Count > 0 && i - preIds[id].First() >= 3)
				{
					int maxPre = 0;
					int idx = preIds[id].BinarySearch(i - 3);
					if (idx < 0)
						idx = ~idx-1;

					int j = preIds[id][idx];
					if (j > 0 && i - j >= 3)
						maxPre = Math.Max(maxPre, maxSplit[j - 1]);

					maxSplit[i] = Math.Max(maxSplit[i], 1 + maxPre);
				}
				/*	if (preIds[id].Count > 0 && i - preIds[id].First() >= 3)
					{
						int maxPre = 0;
						foreach (int j in preIds[id])
						{
							if (j > 0 && i - j >= 3)
								maxPre = Math.Max(maxPre, maxSplit[j - 1]);
						}

						maxSplit[i] = Math.Max(maxSplit[i], 1 + maxPre);
					}*/

				preIds[id].Add(i);
			}

			return maxSplit[len - 1];

    }
}
