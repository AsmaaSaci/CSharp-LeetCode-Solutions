public class Solution
{
    public int SurfaceArea(int[][] grid)
    {
        int n = grid.Length, m = n - 1, sum = n * n << 1, p, q, i, j;        
        for (i = 0; i < n; sum += grid[i][0] + grid[0][i++])        
            for (j = 0, p = n > 1 ? grid[i][1] : 0, q = n > 1 ? grid[1][i] : 0; j < n; j++, p = j >= m ? 0 : grid[i][j + 1], q = j >= m ? 0 : grid[j + 1][i])
                sum += (p > grid[i][j] ? p - grid[i][j] : grid[i][j] - p) + (q > grid[j][i] ? q - grid[j][i] : grid[j][i] - q) - (grid[j][i] == 0 ? 2 : 0);          
        return sum;
    }
}
